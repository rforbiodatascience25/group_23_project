---
title: "correlation_matrix"
format: 
  html:
    self-contained: true
---

# Load Packages

```{r}
library(polycor)
library(corrplot)
library(readr)
library(here)
library(tidyverse)
```

# Load Data

```{r}
#| message: false
patient_sample <- read_tsv(file = here('data','patient_sample_gene_panel.tsv'))
sv <- read_tsv(file = here('data','sv_cleaned.tsv'))
mutations <- read_tsv(file = here('data','data_mutation_cleaned.tsv'))
```

# Data Wrangling

```{r}
mutation_counts <- mutations |>
  select(c(Variant_Classification, Tumor_Sample_Barcode))|>
  group_by(Tumor_Sample_Barcode)|>
  summarise(n_mutations = n())|>
  rename('SAMPLE_ID' = Tumor_Sample_Barcode)

patient_sample_mutations <- patient_sample |>
  select(c(PATIENT_ID, SAMPLE_ID,CANCER_TYPE, TMB_NONSYNONYMOUS, AGE_AT_SEQ_REPORT, TUMOR_PURITY, SEX,OS_MONTHS, OS_STATUS, DRUG_TYPE, SAMPLE_TYPE, SAMPLE_COVERAGE))|>
  left_join(mutation_counts, by = 'SAMPLE_ID')
```

How many mutations per sample

```{r}
mutations |> group_by(Tumor_Sample_Barcode)|>
  summarise(n= n())|>
  ggplot(aes(n))+
  geom_bar()+
  labs(title ='Numbers of Mutations per Sample')
```

# Creating Correlation Matrix

The aim is to find correlations between our information, which might be worth investigating

```{r}
analysis_data <- patient_sample_mutations |> 
  select(-c(PATIENT_ID, SAMPLE_ID))|>
  mutate_if(is.character, as.factor)|>
  mutate_if(is.integer, as.numeric)

str(analysis_data)

correlation_matrix<- hetcor(analysis_data)

corrplot(correlation_matrix$correlations, method="color", tl.col="black", tl.srt=45)
  



```

There are very little correlation between most of the variables. TMB is highly correlated with number of Mutation, which is logical since it is just a normalized version of the number of mutations.
